<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{layout/heads/headDashboard :: headDashboard}"></head>
<body>
<div class="app">
    <!-- SIDEBAR -->
    <div th:replace="~{layout/sidebar :: sidebar}"></div>

    <main class="main">
        <!-- TOPBAR -->
        <header>
            <strong>PANADER√çA WYK ‚Äî Panel Control</strong>

            <div class="search">
                <lord-icon
                        src="https://cdn.lordicon.com/vhdgmtyj.json"
                        trigger="hover"
                        stroke="bold"
                        colors="primary:#933e0d"
                        style="width:50px;height:50px">
                </lord-icon>

                <input id="buscarRapido" placeholder="Buscar‚Ä¶"/>

                <button type="button" class="btn btn-ghost"
                        data-bs-toggle="modal" data-bs-target="#filtroAvanzadoModal">
                    <i data-feather="sliders" style="width:18px;height:18px;color:#94a3b8;"></i>
                </button>
            </div>

            <a th:href="@{/usuarios/formGuardar}">
                <button type="button" class="btn btn-primary">+ Nuevo usuario</button>
            </a>
        </header>


        <div class="layout">
            <!-- HERO -->
            <section class="hero">
                <div>
                    <div class="hero-note">¬°Buen d√≠a!</div>
                    <h2>Bienvenidos a la pander√≠a,
                        <!--                            <span style="color:var(&#45;&#45;primary)" th:text="${userName}"></span>-->
                    </h2>

                    <div class="hero-note">Que el aroma del pan reci√©n horneado te acompa√±e hoy üçû</div>

                    <div style="margin-top:12px; display:flex; gap:10px;">
                        <button class="btn btn-ghost">Ver agenda</button>
                    </div>
                </div>

                <div class="illus">
                    <div class="floaty"></div>
                    <div class="bread">ü•ñ</div>
                    <div class="croissant">ü•ê</div>
                </div>
            </section>


            <!-- KPIs -->
            <section class="stats">
                <div class="stat">
                    <div>
                        <div class="muted">Usuarios existentes</div>
                        <div class="kpi" th:text="${usuariosExistentes}"></div>
                    </div>
                    <div class="icon">
                        <lord-icon
                                src="https://cdn.lordicon.com/oqhqyeud.json"
                                trigger="hover"
                                stroke="bold"
                                colors="primary:#933e0d,secondary:#933e0d"
                                style="width:40px;height:40px">
                        </lord-icon>
                    </div>
                </div>

                <div class="stat">
                    <div>
                        <div class="muted">Usuarios activos</div>
                        <div class="kpi" th:text="${usuariosActivos}"></div>
                    </div>
                    <div class="icon">
                        <lord-icon
                                src="https://cdn.lordicon.com/oqhqyeud.json"
                                trigger="hover"
                                stroke="bold"
                                colors="primary:#933e0d,secondary:#933e0d"
                                style="width:40px;height:40px">
                        </lord-icon>
                    </div>
                </div>

                <div class="stat">
                    <div>
                        <div class="muted">Usuarios inactivos</div>
                        <div class="kpi" th:text="${usuariosInactivos}"></div>
                    </div>
                    <div class="icon">
                        <lord-icon
                                src="https://cdn.lordicon.com/oqhqyeud.json"
                                trigger="hover"
                                stroke="bold"
                                colors="primary:#933e0d,secondary:#933e0d"
                                style="width:40px;height:40px">
                        </lord-icon>
                    </div>
                </div>
            </section>


            <!-- TABLA DE USUARIOS -->
            <div class="section-reportes">
                <div class="table-header">
                    <strong>Tabla de usuarios</strong>
                    <button type="button" id="generatePdfBtnUsuario" style="display:flex; align-items:center;" class="btn btn-ghost btp-personalizado">
                        <span>Generar PDF</span>
                        <lord-icon
                                src="https://cdn.lordicon.com/gyyhoycg.json"
                                trigger="hover"
                                stroke="bold"
                                colors="primary:#fff"
                                style="width:50px;height:50px">
                        </lord-icon>
                    </button>
                </div>

                <table id="tablaUsuarios" class="tabla-consultas">
                    <thead>
                    <tr>
                        <th>N√∫mero Doc</th>
                        <th>Nombre</th>
                        <th>Tel√©fono</th>
                        <th>Email</th>
                        <th>Fecha Registro</th>
                        <th>Rol</th>
                        <th>Estado</th>
                        <th colspan="3" style="text-align:center">Acciones</th>
                    </tr>
                    </thead>

                    <tbody>
                    <!-- SI HAY USUARIOS -->
                    <tr th:each="u : ${listaUsuarios}">
                        <td th:text="${u.numDoc}"></td>
                        <td th:text="${u.nombre}"></td>
                        <td th:text="${u.telUsuario}"></td>
                        <td th:text="${u.emailUsuario}"></td>
                        <td>
<!--                            Este span es para que el filtro js se base es en este y no en los otros que est√°n separados y por ende el filtro no funcionaria.-->
                            <span th:text="${#temporals.format(u.fechaRegistro, 'yyyy-MM-dd HH:mm:ss')}" class="fecha-completa" style="display:none;"></span>

                            <span th:text="${#temporals.format(u.fechaRegistro, 'yyyy-MM-dd')}"></span><br>
                            <span th:text="${#temporals.format(u.fechaRegistro, 'HH:mm:ss')}"></span>
                        </td>
                        <td th:text="${u.rol.rol}"></td>

                        <td>
                            <input type="checkbox"
                                   th:id="'switch_' + ${u.idUsuario}"
                                   th:data-id="${u.idUsuario}"
                                   th:checked="${u.estadoUsuario} == true">

                            <label th:for="'switch_' + ${u.idUsuario}" class="check-trail">
                                <span class="check-handler"></span>
                            </label>
                        </td>

                        <td>
                            <a th:href="@{/usuarios/formAct/{id}(id=${u.idUsuario})}"
                               class="btn btn-sm btn-primary btn-actualizar">
                                <lord-icon
                                        src="https://cdn.lordicon.com/ibckyoan.json"
                                        trigger="hover"
                                        colors="primary:#ffffff"
                                        style="width:30px;height:30px">
                                </lord-icon>
                            </a>
                        </td>

                        <td>
                            <button class="btn btn-sm btn-danger delete-usuario"
                                    th:data-id="${u.idUsuario}">
                                <lord-icon
                                        src="https://cdn.lordicon.com/oqeixref.json"
                                        trigger="morph"
                                        state="morph-trash-full"
                                        colors="primary:#ffffff"
                                        style="width:30px;height:30px">
                                </lord-icon>
                            </button>
                        </td>
                    </tr>

                    <!-- SI NO HAY USUARIOS -->
                    <tr th:if="${#lists.isEmpty(listaUsuarios)}">
                        <td colspan="5" style="text-align:center">No hay usuarios disponibles.</td>
                    </tr>

                    </tbody>
                </table>
            </div>

        </div>
        <!-- MODAL CONSULTAS -->
        <div th:replace="~{/usuario/modalConsultas :: modalConsultas}"></div>
        <!-- FOOTER -->
        <div th:replace="~{/layout/footers/footerDashboard :: footerDashboard}"></div>
    </main>
</div>

<!-- LIBRER√çAS -->
<script src="https://unpkg.com/feather-icons"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        crossorigin="anonymous">
</script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"
        integrity="sha256-Lye89HGy1p3XhJT24hcvsoRw64Q4IOL5a7hdOflhjTA="
        crossorigin="anonymous">
</script>

<!-- VARIABLES GLOBALES -->
<script th:inline="javascript">
    const APP_URL = /*[[${@environment.getProperty('app.url')}]]*/ '';

    const CSRF_TOKEN = /*[[${_csrf.token}]]*/ "";
    const CSRF_HEADER = /*[[${_csrf.headerName}]]*/ "";
</script>

<!-- JS DEL SISTEMA -->
<script th:src="@{/js/dashboard.js}"></script>
<script th:src="@{/js/sidebar.js}"></script>
<script th:src="@{/js/logout.js}"></script>


<!-- JS CRUD USUARIOS -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script th:src="@{/js/usuario/confirmState.js}"></script>
<script th:src="@{/js/usuario/confirmDelete.js}"></script>

<!-- BUSQUEDA Y PDF -->
<script th:src="@{/js/usuario/busquedaFiltro.js}"></script>
<script th:src="@{/js/usuario/PDFgenerateFilter.js}"></script>
</body>
</html>
